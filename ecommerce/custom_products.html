<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="css/steps.css">
    <script src="js/jquery-3.4.1.js"></script>
    <script src="js/jquery.steps.js"></script>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/home.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Amatic+SC&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css">
    <script src="lena.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/jamesssooi/Croppr.js@2.3.0/dist/croppr.min.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/jamesssooi/Croppr.js@2.3.0/dist/croppr.min.css" rel="stylesheet"/>
</head>
<body>
    <section class="headerEcommerce">
        <nav id="mainNav" class="navbar level is-fixed-top">
            <div class="level-left">
            <div class="level-item">
                <a>
                <img class="logo" src="resources/logo.png">
                </a>
            </div>
            </div>
            </div>
    
            <div class="level-right navbar-end">
    
            <div class="level-item">
                <div class="field has-addons">
                <p class="control">
                    <button class="button is-danger">
                    <span class="icon">
                        <i class="fas fa-search"></i>
                    </span>
                    </button>
                </p>
                <p class="control">
                    <input class="input is-danger" type="text" placeholder="Buscar">
                </p>
                </div>
            </div>
            <div class="level-item">
                <a class="is-danger">
                <span class="icon">
                    <i class="fas fa-user-circle fa-lg"></i>
                </span>
                </a>
            </div>
            <div class="level-item">
                <a>
                <span class="icon">
                    <i class="fas fa-shopping-cart fa-lg"></i>
                </span>
                </a>
            </div>
            </div>
        </nav>
        <div id="MenuEcommerce">
            <nav id="secondNav" class="navbar is-fixed-top is-purple has-text-centered" style="margin-top: 68px;">
            <div class="navbar-menu has-text-centered">
                <div class="navbar-start" style="padding-left: 100px;">
                    <a class="navbar-item" href="index.html">
                        Home
                    </a>
                <div class="navbar-item has-dropdown is-hoverable">
                    <a class="navbar-link">
                    Foto-Libros
                    </a>
                    <div class="navbar-dropdown">
                    <div class="columns">
                        <div class="column">
                        <span id="titMenu" class="navbar-item">
                            Artículos Personalizados<br>
                        </span>
                        <img src="resources/blur-blurred-book-pages-46274.jpg" alt="img2">
                        </div>
    
                        <div class="column">
                        <br><br>
                        <a class="navbar-item" href="menu.html">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Foto-Libro con Fotos
                        </a>
                        
                        
                        <a class="navbar-item">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Foto-Libro sin Fotos
                        </a>
                        <hr class="navbar-divider">
                        <a class="navbar-item">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Caja con Fotos
                        </a>
                        </div>
                        <div class="column rightSide">
                        <br><br>
                        <img src="resources/pexels-photo-970076.jpeg" alt="img1">
                        <br>
                        <span class="navbar-item">
                            <strong> ¡Conócelos!</strong>
                        </span>
                        </div>
    
                    </div>
                    </div>
                </div>
                <div class="navbar-item has-dropdown is-hoverable">
                    <a class="navbar-link">
                    Foto-Regalos
                    </a>
                    <div class="navbar-dropdown">
                    <div class="columns">
                        <div class="column">
                        <span id="titMenu" class="navbar-item">
                            Artículos Personalizados<br>
                        </span>
                        <img src="resources/blur-blurred-book-pages-46274.jpg" alt="img2">
                        <br>
                        <br>
                        <div>
                            <img src="resources/background-notebook-pencil-544115.jpg" alt="img3">
                        </div>
                        
                        </div>
                        <div class="column">
                        <br><br>
                        <a class="navbar-item">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Carcasa para Celular
                        </a>
                        <a class="navbar-item">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Invitación a evento - Tarjeta de felicitación
                        </a>
                        <a class="navbar-item">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Portavasos
                        </a>
                        <a class="navbar-item">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Porta-retrato
                        </a>
                        <a class="navbar-item">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Rompecabezas
                        </a>
                        <a class="navbar-item">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Termo
                        </a>
                        <a class="navbar-item">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Libreta
                        </a>
                        <a class="navbar-item">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Mousepad
                        </a>
                        <a class="navbar-item">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Playera
                        </a>
                        <a class="navbar-item">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Lapicero
                        </a>
                        </div>
                        
                    </div>
                    </div>
                </div>
    
                <div class="navbar-item has-dropdown is-hoverable">
                    <a class="navbar-link">
                    Foto-Marcos
                    </a>
                    <div class="navbar-dropdown">
                    <div class="columns">
                        <div class="column">
                        <span id="titMenu" class="navbar-item">
                            Artículos Personalizados<br>
                        </span>
                        <img src="resources/blur-blurred-book-pages-46274.jpg" alt="img2">
                        </div>
                        <div class="column">
                        <br><br>
                        <a class="navbar-item">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Marco con Foto
                        </a>
                        <a class="navbar-item">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Marco sin Foto
                        </a>
                        <hr class="navbar-divider">
                        <a class="navbar-item">
                            <span class="icon">
                            <i class="fas fa-feather-alt"></i>
                            </span> Bastidor con Foto
                        </a>
                        </div>
                        <div class="column rightSide">
                        <br><br>
                        <img src="resources/frame.jpg" alt="img1">
                        <br>
                        <span class="navbar-item">
                            <strong> ¡Conócelos!</strong>
                        </span>
                        </div>
    
                    </div>
                    </div>
                </div>
                </div>
            </nav>
        </div>
            
    </section>
    
<section id="step-section">
    <div id="example-basic">
        <h3>Agrega una foto</h3>
        <section>
            <p>Carga una imagen desde tu equipo para comenzar a editar:</p>
            
            <div class="field">
                <div class="file is-large is-boxed">
                    <label class="file-label">
                    <input class="file-input" type="file" id="image" name="resume">
                    <span class="file-cta">
                        <span class="file-icon">
                        <i class="fas fa-upload"></i>
                        </span>
                        <span class="file-label">
                        Cargar archivo…
                        </span>
                    </span>
                    </label>
                </div>
            </div>
        </section>
        <h3>Recorta</h3>
        <section>
            
            <div id="editor"></div>

            <p>3 Previsualiza el resultado</p>

            <canvas id="preview"></canvas>
            <canvas id="canvas"></canvas>
            
        </section>

        <h3>Selecciona un filtro</h3>
        <section>
            <div id="main">
                    
                <label for="filter-changer">Selecciona un filtro a aplicar:</label>
                <br>
                <div class="multiple-items">
                    <div>
                        <p>Normal</p>                      
                        <canvas id="filtro1" maxHeight="100px" class="filtered-image-carousel"></canvas>
                    </div>
                    <div>
                        <p>Desenfoque</p>
                        <canvas id="filtro2" maxHeight="100px" class="filtered-image-carousel"></canvas>
                    </div>
                    <div>
                        <p>Escala de Grises</p>
                        <canvas id="filtro3" maxHeight="100px" class="filtered-image-carousel"></canvas>
                    </div>
                    <div>
                        <p>Invertir color</p>
                        <canvas id="filtro4" maxHeight="100px" class="filtered-image-carousel"></canvas>
                    </div>
                    <div>
                        <p>Saturacion</p>
                        <canvas id="filtro5" maxHeight="100px" class="filtered-image-carousel"></canvas>                       
                    </div>
                    <div>
                        <p>Sepia</p>
                        <canvas id="filtro6" maxHeight="100px" class="filtered-image-carousel"></canvas>
                    </div>
                    <div>
                        <p>Sharpen</p>
                        <canvas id="filtro7" maxHeight="100px" class="filtered-image-carousel"></canvas>
                    </div>
                    <div>
                        <p>Thresholding</p>
                        <canvas id="filtro8" maxHeight="100px" class="filtered-image-carousel"></canvas>
                    </div>
                </div>

                <div id="imagen" style="display: inline;"></div>
                <canvas id="filtered-image" style="display: inline;"></canvas>
                
               
            </div>
            

        </section>
    </div>
</section>
 
<script>
     //data-slick='{"slidesToShow": 4, "slidesToScroll": 4}'
     //habilitamos el steps
    $("#example-basic").steps({
        headerTag: "h3",
        bodyTag: "section",
        transitionEffect: "slideLeft",
        autoFocus: true
    });
    
</script>
<script>
    // Esperamos a que todo el HTML esté cargado antes de ejecutar Javascrip
document.addEventListener('DOMContentLoaded', () => {

    // Input File
    const inputImage = document.querySelector('#image');
    // Nodo donde estará el editor
    const editor = document.querySelector('#editor');
    // El canvas donde se mostrará la previa
    const miCanvas = document.querySelector('#preview');
    // Contexto del canvas
    const contexto = miCanvas.getContext('2d');
    // Ruta de la imagen seleccionada
    let urlImage = undefined;
    // Evento disparado cuando se adjunte una imagen
    inputImage.addEventListener('change', abrirEditor, false);

    /**
    * Método que abre el editor con la imagen seleccionada
    */
    function abrirEditor(e) {
        // Obtiene la imagen
        urlImage = URL.createObjectURL(e.target.files[0]);

        // Borra editor en caso que existiera una imagen previa
        editor.innerHTML = '';
        let cropprImg = document.createElement('img');
        cropprImg.setAttribute('id', 'croppr');
        editor.appendChild(cropprImg);

        // Limpia la previa en caso que existiera algún elemento previo
        contexto.clearRect(0, 0, miCanvas.width, miCanvas.height);

        // Envia la imagen al editor para su recorte
        document.querySelector('#croppr').setAttribute('src', urlImage);

        // Crea el editor
        new Croppr('#croppr', {
            aspectRatio: 1,
            startSize: [70, 70],
            onCropEnd: recortarImagen
        })
    }

    /**
    * Método que recorta la imagen con las coordenadas proporcionadas con croppr.js
    */
    var filteredImageCanvas = document.getElementById("filtered-image");
    console.log(typeof filteredImageCanvas);

    function recortarImagen(data) {
        // Variables
        const inicioX = data.x;
        const inicioY = data.y;
        const nuevoAncho = data.width;
        const nuevaAltura = data.height;
        const zoom = 1;
        let imagenEn64 = '';
        let imagenFinal64 ='';
        // La imprimo
        miCanvas.width = nuevoAncho;
        miCanvas.height = nuevaAltura;
        // La declaro
        let miNuevaImagenTemp = new Image();
        // Cuando la imagen se carge se procederá al recorte
        miNuevaImagenTemp.onload = function() {
            // Se recorta
            contexto.drawImage(miNuevaImagenTemp, inicioX, inicioY, nuevoAncho * zoom, nuevaAltura * zoom, 0, 0, nuevoAncho, nuevaAltura);
            
            // Se transforma a base64
            imagenEn64 = miCanvas.toDataURL("image/jpeg");
            // Mostramos el código generado
            //document.querySelector('#base64').textContent = imagenEn64;
            
            var img = document.getElementById("imagen");
            img.innerHTML='<img id="original-image" src="'+imagenEn64+'"/>'; 

            //obtenemos la imagen base
            var originalImage = document.getElementById("original-image");
            console.log(typeof originalImage);
          
            //llenamos el carousel
            var filteredImage= document.getElementsByClassName("filtered-image-carousel");
            var imageUploaded = false;
            var reader;
            originalImage.onload = function(){
                console.log("Image Succesfully Loaded");
                imageUploaded = true;
                LenaJS.filterImage(filteredImage[0], LenaJS["none"], originalImage,160,90);
                LenaJS.filterImage(filteredImage[1], LenaJS["gaussian"], originalImage,160,90);
                LenaJS.filterImage(filteredImage[2], LenaJS["grayscale"], originalImage,160,90);
                LenaJS.filterImage(filteredImage[3], LenaJS["invert"], originalImage,160,90);
                LenaJS.filterImage(filteredImage[4], LenaJS["saturation"], originalImage,160,90);
                LenaJS.filterImage(filteredImage[5], LenaJS["sepia"], originalImage,160,90);
                LenaJS.filterImage(filteredImage[6], LenaJS["sharpen"], originalImage,160,90);
                LenaJS.filterImage(filteredImage[7], LenaJS["thresholding"], originalImage,160,90);
                $('.multiple-items').slick({
                    infinite: true,
                    slidesToShow: 4,
                    slidesToScroll: 4
                });
            };
            //agregamos los eventos
            document.getElementById("filtro1").onclick = function(){
                LenaJS.filterImage(filteredImageCanvas, LenaJS['none'], originalImage,originalImage.width,originalImage.height);
                //generamos el nuevo base 64
                imagenFinal64 = filteredImageCanvas.toDataURL("image/jpeg");
                //this.attr('selected','selected');
                console.log(imagenFinal64)
            };
            document.getElementById("filtro2").onclick = function(){
                LenaJS.filterImage(filteredImageCanvas, LenaJS['gaussian'], originalImage,originalImage.width,originalImage.height);
                imagenFinal64 = filteredImageCanvas.toDataURL("image/jpeg");
                console.log(imagenFinal64)
            };
            document.getElementById("filtro3").onclick = function(){
                LenaJS.filterImage(filteredImageCanvas, LenaJS['grayscale'], originalImage,originalImage.width,originalImage.height);
                imagenFinal64 = filteredImageCanvas.toDataURL("image/jpeg");
                console.log(imagenFinal64)
            };
            document.getElementById("filtro4").onclick = function(){
                LenaJS.filterImage(filteredImageCanvas, LenaJS['invert'], originalImage,originalImage.width,originalImage.height);
                imagenFinal64 = filteredImageCanvas.toDataURL("image/jpeg");
                console.log(imagenEn64)
            };
            document.getElementById("filtro5").onclick = function(){
                LenaJS.filterImage(filteredImageCanvas, LenaJS['saturation'], originalImage,originalImage.width,originalImage.height);
                imagenFinal64 = filteredImageCanvas.toDataURL("image/jpeg");

                console.log(imagenEn64)
            };
            document.getElementById("filtro6").onclick = function(){
                LenaJS.filterImage(filteredImageCanvas, LenaJS['sepia'], originalImage,originalImage.width,originalImage.height);
                imagenFinal64 = filteredImageCanvas.toDataURL("image/jpeg");
                console.log(imagenEn64)
            };
            document.getElementById("filtro7").onclick = function(){
                LenaJS.filterImage(filteredImageCanvas, LenaJS['sharpen'], originalImage,originalImage.width,originalImage.height);
                imagenFinal64 = filteredImageCanvas.toDataURL("image/jpeg");
                console.log(imagenEn64)
            };
            document.getElementById("filtro8").onclick = function(){
                LenaJS.filterImage(filteredImageCanvas, LenaJS['thresholding'], originalImage,originalImage.width,originalImage.height);
                imagenFinal64 = filteredImageCanvas.toDataURL("image/jpeg");
                console.log(imagenEn64)
            };
            //document.querySelector('#base64HTML').textContent = '<img src="' + imagenEn64.slice(0, 40) + '...">';            
        
        }
        // Proporciona la imagen cruda, sin editarla por ahora
        miNuevaImagenTemp.src = urlImage;
    }
    

});

    

</script>
    
</body>
</html>